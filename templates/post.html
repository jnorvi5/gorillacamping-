{% extends "base.html" %}

{% block title %}<title id="post-title">Blog Post | Gorilla Camping</title>{% endblock %}
{% block meta_description %}<meta name="description" id="meta-desc" content="">{% endblock %}

{% block content %}
  <article class="blog-post" id="blog-post">
    <h1>Loading...</h1>
    <div>Loading blog post...</div>
  </article>
{% endblock %}

{% block extra_scripts %}
<script>
function getSlug() {
    // This is not a robust way to get the slug, but it will work for now
    // It assumes the URL is /blog/<slug>
    const path = window.location.pathname;
    return path.substring(path.lastIndexOf('/') + 1);
}
fetch(`/api/blog-post/${getSlug()}`)
  .then(res => res.json())
  .then(post => {
    if (post.error) {
      document.getElementById('blog-post').innerHTML = '<h1>Not found</h1>';
      document.title = "Not found | Gorilla Camping";
      return;
    }
    document.getElementById('blog-post').innerHTML = `
      <h1>${post.title}</h1>
      <p><em>Published on ${post.created_at}</em></p>
      <div>${post.content}</div>
    `;
    document.title = `${post.title} | Gorilla Camping`;
    document.getElementById('meta-desc').content = post.meta_description || '';
  })
  .catch(() => {
    document.getElementById('blog-post').innerHTML = '<h1>Error loading post</h1>';
  });
</script>
{% endblock %}

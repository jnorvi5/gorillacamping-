<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Gorilla Camping - Guerilla-style camping guides, gear reviews, and off-grid living tips for budget-conscious adventurers.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}guerilla camping, off-grid living, camping gear reviews, budget camping, DIY camping, veteran camping{% endblock %}">
    <meta name="author" content="Guerilla the Gorilla - Gorilla Camping">
    <title>{% block title %}Gorilla Camping - Guerilla-Style Camping & Off-Grid Living{% endblock %}</title>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://gorillacamping.site{{ request.path }}">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://static.gorillacamping.site/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://static.gorillacamping.site/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://static.gorillacamping.site/favicon-16x16.png">
    <link rel="manifest" href="https://static.gorillacamping.site/site.webmanifest">
    
    <!-- Fonts & CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://static.gorillacamping.site/css/guerilla.css">

    <!-- Social Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.meta_description() }}{% endblock %}">
    <meta property="og:image" content="https://static.gorillacamping.site/img/logo.png">
    <meta property="og:url" content="https://gorillacamping.site{{ request.path }}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="Gorilla Camping">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ self.title() }}">
    <meta name="twitter:description" content="{{ self.meta_description() }}">
    <meta name="twitter:image" content="https://static.gorillacamping.site/img/logo.png">

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Gorilla Camping",
      "url": "https://gorillacamping.site",
      "logo": "https://static.gorillacamping.site/img/logo.png",
      "description": "Guerilla-style camping guides, gear reviews, and off-grid living tips for budget-conscious adventurers.",
      "founder": {
        "@type": "Person",
        "name": "Guerilla the Gorilla",
        "description": "Army veteran and off-grid camping expert"
      }
    }
    </script>

    {% block extra_head %}{% endblock %}

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JPKKPRXX6S"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JPKKPRXX6S');
      
      function trackAffiliateClick(affiliateUrl, productName) {
        gtag('event', 'affiliate_click', {
          'event_category': 'Affiliate',
          'event_label': affiliateUrl,
          'custom_parameter_1': productName
        });
      }
    </script>

    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "rprq55166f");
    </script>
</head>
<body>
    <header class="gc-header">
        <div class="logo-container">
            <a href="/" aria-label="Gorilla Camping Home">
                <img src="https://static.gorillacamping.site/img/logo.png"
                     alt="Gorilla Camping Logo - Guerilla Style Camping"
                     class="header-logo-glow"
                     width="140"
                     height="140">
            </a>
        </div>
        <h1 class="gc-motto-glow">Life is short, just camp through it!</h1>
        <nav class="gc-nav" role="navigation" aria-label="Main Navigation">
            <a href="/" {% if request.path=='/' %}class="active" aria-current="page"{% endif %}>Home</a>
            <a href="/blog" {% if request.path.startswith('/blog') %}class="active" aria-current="page"{% endif %}>Blog</a>
            <a href="/gear" {% if request.path=='/gear' %}class="active" aria-current="page"{% endif %}>Gear</a>
            <a href="/about" {% if request.path=='/about' %}class="active" aria-current="page"{% endif %}>About</a>
            <a href="/contact" {% if request.path=='/contact' %}class="active" aria-current="page"{% endif %}>Contact</a>
        </nav>
    </header>

    <main role="main">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="flash flash-{{ category }}" role="alert">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Guerilla Chat - Fixed Implementation -->
    <div id="guerilla-chat" style="position:fixed; bottom:20px; right:20px; z-index:9999;">
        <!-- Chat toggle button -->
        <div id="guerilla-toggle" style="width:60px; height:60px; background:#111; border-radius:50%; border:2px solid #00ff88; box-shadow:0 0 15px rgba(0,255,136,0.4); display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative;">
            <img src="https://static.gorillacamping.site/img/logo.png" alt="Guerilla" style="width:40px; height:40px; border-radius:50%;">
            <span id="guerilla-badge" style="position:absolute; top:-5px; right:-5px; background:#ff4136; color:white; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:bold; border:2px solid #111;">!</span>
        </div>
        
        <!-- Chat box -->
        <div id="guerilla-box" style="position:absolute; bottom:75px; right:0; width:320px; background:#222; border-radius:10px; overflow:hidden; display:none; box-shadow:0 0 20px rgba(0,0,0,0.3); border:2px solid rgba(0,255,136,0.3);">
            <!-- Header -->
            <div style="background:#111; padding:10px 15px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(0,255,136,0.3);">
                <div style="display:flex; align-items:center; gap:10px;">
                    <img src="https://static.gorillacamping.site/img/logo.png" style="width:30px; height:30px; border-radius:50%; border:2px solid #00ff88;">
                    <div>
                        <div style="font-weight:bold; color:#00ff88;">Guerilla</div>
                        <div style="font-size:12px; color:#aaa;">Camping Expert</div>
                    </div>
                </div>
                <div id="guerilla-close" style="cursor:pointer; font-size:20px; color:#aaa;">×</div>
            </div>
            
            <!-- Messages -->
            <div id="guerilla-messages" style="height:300px; overflow-y:auto; padding:15px;"></div>
            
            <!-- Input -->
            <div style="padding:10px; display:flex; gap:10px; border-top:1px solid rgba(255,255,255,0.1);">
                <input id="guerilla-input" type="text" placeholder="Ask about camping gear..." style="flex:1; padding:8px 12px; border-radius:20px; border:1px solid rgba(0,255,136,0.3); background:#333; color:white; outline:none;">
                <button id="guerilla-send" style="background:#00ff88; color:#111; border:none; width:34px; height:34px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;">→</button>
            </div>
        </div>
    </div>

    <footer class="gc-footer">
        <div class="footer-content">
            <!-- Social Links -->
            <div class="social-links">
                <h3>Join the Guerilla Tribe</h3>
                <div class="social-icons">
                    <a href="{{ url_for('social_redirect', platform='reddit') }}" class="social-link reddit" aria-label="Join us on Reddit">Reddit</a>
                    <a href="{{ url_for('social_redirect', platform='facebook') }}" class="social-link facebook" aria-label="Follow us on Facebook">Facebook</a>
                    <a href="{{ url_for('social_redirect', platform='tiktok') }}" class="social-link tiktok" aria-label="Follow us on TikTok">TikTok</a>
                </div>
            </div>
            
            <!-- Guerilla Tips -->
            <div id="guerilla-tips" style="font-size:1.1em;color:#00ff88;margin-bottom:1em;">
                <img src="https://static.gorillacamping.site/img/logo.png" alt="Guerilla tip" style="width:32px;vertical-align:middle;margin-right:10px;border-radius:50%;box-shadow:0 0 4px #00ff88;">
                <span id="guerilla-tip-text">Guerilla says: "If it ain't broke, you can still fix it."</span>
            </div>
            
            <p>&copy; 2025 Gorilla Camping. All Rights Reserved.</p>
            <p class="disclaimer">
                Guerilla-style affiliate marketing. Some links may earn us a small commission at no extra cost to you. 
                <a href="/privacy" class="footer-link">Privacy Policy</a> | 
                <a href="/contact" class="footer-link">Contact</a>
            </p>
            <div class="footer-social">
                <p>Built with Flask, Azure AI & Pure Guerilla Hustle 🏕️💪</p>
            </div>
        </div>
    </footer>

    <!-- Enhanced JavaScript -->
    <script>
    // Guerilla Chat - Enhanced Implementation
    document.addEventListener('DOMContentLoaded', function() {
        const toggle = document.getElementById('guerilla-toggle');
        const close = document.getElementById('guerilla-close');
        const chatBox = document.getElementById('guerilla-box');
        const messages = document.getElementById('guerilla-messages');
        const input = document.getElementById('guerilla-input');
        const sendBtn = document.getElementById('guerilla-send');
        const badge = document.getElementById('guerilla-badge');
        
        // Toggle chat
        toggle.addEventListener('click', function() {
            chatBox.style.display = chatBox.style.display === 'none' ? 'block' : 'none';
            badge.style.display = 'none';
            
            // Show initial message if first time
            if (messages.children.length === 0) {
                addMessage("Yo! I'm Guerilla the Gorilla. Need advice on camping gear, survival tips, or making money while living off-grid? Just ask!", 'ai');
            }
        });
        
        // Close chat
        close.addEventListener('click', function() {
            chatBox.style.display = 'none';
        });
        
        // Send message
        sendBtn.addEventListener('click', sendMessage);
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;
            
            // Add user message
            addMessage(text, 'user');
            input.value = '';
            
            // Show typing indicator
            addMessage('Guerilla is thinking...', 'ai', true);
            
            try {
                const response = await fetch('/api/guerilla-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: text })
                });
                
                const result = await response.json();
                
                // Remove typing indicator
                const typingMsg = document.getElementById('typing-message');
                if (typingMsg) typingMsg.remove();
                
                if (result.success) {
                    addMessage(result.response, 'ai');
                    
                    // Add product recommendations if any
                    if (result.recommendations && result.recommendations.length > 0) {
                        result.recommendations.forEach(product => {
                            addProductRecommendation(product);
                        });
                    }
                } else {
                    addMessage("Sorry, having technical difficulties. Try again!", 'ai');
                }
            } catch (error) {
                // Remove typing indicator
                const typingMsg = document.getElementById('typing-message');
                if (typingMsg) typingMsg.remove();
                
                addMessage("Connection issue. Check your network and try again.", 'ai');
            }
        }
        
        function addMessage(text, sender, isTyping = false) {
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '15px';
            messageDiv.style.display = 'flex';
            messageDiv.style.gap = '10px';
            
            if (isTyping) {
                messageDiv.id = 'typing-message';
            }
            
            if (sender === 'ai') {
                messageDiv.innerHTML = `
                    <img src="https://static.gorillacamping.site/img/logo.png" style="width:30px; height:30px; border-radius:50%; align-self:flex-start;">
                    <div style="background:#333; padding:10px; border-radius:10px; color:white; max-width:80%;">${text}</div>
                `;
            } else {
                messageDiv.style.flexDirection = 'row-reverse';
                messageDiv.innerHTML = `
                    <div style="background:rgba(0,255,136,0.2); padding:10px; border-radius:10px; color:white; max-width:80%;">${text}</div>
                `;
            }
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function addProductRecommendation(product) {
            const productDiv = document.createElement('div');
            productDiv.style.marginBottom = '15px';
            productDiv.style.display = 'flex';
            productDiv.style.gap = '10px';
            
            productDiv.innerHTML = `
                <img src="https://static.gorillacamping.site/img/logo.png" style="width:30px; height:30px; border-radius:50%; align-self:flex-start;">
                <div style="max-width:80%;">
                    <div style="background:#333; padding:10px; border-radius:10px 10px 0 0; color:white;">Check this out:</div>
                    <div style="border:1px solid rgba(0,255,136,0.3); border-top:none; border-radius:0 0 10px 10px; overflow:hidden; background:rgba(0,0,0,0.3);">
                        <div style="display:flex; padding:10px; gap:10px; align-items:center;">
                            <img src="${product.image}" style="width:50px; height:50px; object-fit:contain; border-radius:5px;">
                            <div>
                                <div style="font-weight:bold; color:white;">${product.name}</div>
                                <div style="color:#00ff88;">${product.price}</div>
                            </div>
                        </div>
                        <div style="background:#00ff88; text-align:center; padding:8px;">
                            <a href="/affiliate/${product.id}" style="color:#111; text-decoration:none; font-weight:bold;" 
                               onclick="trackAffiliateClick('/affiliate/${product.id}', '${product.name}')">VIEW DEAL →</a>
                        </div>
                    </div>
                </div>
            `;
            
            messages.appendChild(productDiv);
            messages.scrollTop = messages.scrollHeight;
        }
        
        // Rotating tips
        const tips = [
            "If it ain't broke, you can still fix it.",
            "Affiliate links keep my bananas fresh.",
            "No plan survives contact with the wild—but we improvise.",
            "Stealth, hustle, survive. That's the Guerilla way.",
            "If you can camp here, you can camp anywhere.",
            "A hot meal and a cold mindset solve 90% of problems.",
            "Ask for forgiveness, never for permission.",
            "Never trust a man with a clean multi-tool.",
            "Leave no trace, but leave a story.",
            "The wild rewards the clever."
        ];
        
        let tipIndex = 0;
        setInterval(() => {
            tipIndex = (tipIndex + 1) % tips.length;
            const tipElement = document.getElementById('guerilla-tip-text');
            if (tipElement) {
                tipElement.textContent = `Guerilla says: "${tips[tipIndex]}"`;
            }
        }, 6000);
        
        // Show chat bubble after 30 seconds
        setTimeout(() => {
            if (chatBox.style.display !== 'block') {
                badge.style.display = 'flex';
                toggle.style.animation = 'pulse 2s infinite';
            }
        }, 30000);
    });
    
    // CSS Animation for pulse effect
    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>
